{
  "name": "Azure_Audit_Security_Agent_Installed_On_Linux_VMSS",
  "policy_id": "/providers/Microsoft.Authorization/policyDefinitions/62b52eae-c795-44e3-94e8-1b3d264766fb",
  "display_name": "Azure Audit Security Agent Installed On Linux VMSS",
  "description": "Install the Azure Security agent on your Linux virtual machine scale sets in order to monitor your machines for security configurations and vulnerabilities. Results of the assessments can seen and managed in Azure Security Center.",
  "category": "service",
  "status": "active",
  "content": "{\r\n      \"displayName\": \"[Preview]: Azure Security agent should be installed on your Linux virtual machine scale sets\",\r\n      \"policyType\": \"BuiltIn\",\r\n      \"mode\": \"Indexed\",\r\n      \"description\": \"Install the Azure Security agent on your Linux virtual machine scale sets in order to monitor your machines for security configurations and vulnerabilities. Results of the assessments can seen and managed in Azure Security Center.\",\r\n      \"metadata\": {\r\n        \"category\": \"Security Center\",\r\n        \"version\": \"1.0.0-preview\",\r\n        \"policy_id\": \"/providers/Microsoft.Authorization/policyDefinitions/62b52eae-c795-44e3-94e8-1b3d264766fb\"\r\n      },\r\n      \"parameters\": {\r\n        \"effect\": {\r\n          \"type\": \"String\",\r\n          \"metadata\": {\r\n            \"displayName\": \"Effect\",\r\n            \"description\": \"Enable or disable the execution of the policy\"\r\n          },\r\n          \"allowedValues\": [\r\n            \"AuditIfNotExists\",\r\n            \"Disabled\"\r\n          ],\r\n          \"defaultValue\": \"AuditIfNotExists\"\r\n        }\r\n      },\r\n      \"policyRule\": {\r\n        \"if\": {\r\n          \"allOf\": [\r\n            {\r\n              \"field\": \"type\",\r\n              \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n            },\r\n            {\r\n              \"anyOf\": [\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"RedHat\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"RHEL\",\r\n                        \"RHEL-SAP-HANA\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"6*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"7*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"8*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"SUSE\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"SLES\",\r\n                        \"SLES-HPC\",\r\n                        \"SLES-HPC-Priority\",\r\n                        \"SLES-SAP\",\r\n                        \"SLES-SAP-BYOS\",\r\n                        \"SLES-Priority\",\r\n                        \"SLES-BYOS\",\r\n                        \"SLES-SAPCAL\",\r\n                        \"SLES-Standard\",\r\n                        \"SLES-12-SP5\",\r\n                        \"SLES-15-SP2\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"12*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"15*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"gen*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"Canonical\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"UbuntuServer\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"14.04*LTS\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"16.04*LTS\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"18.04*LTS\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"18_04-lts*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"Canonical\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"0001-com-ubuntu-server-focal\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSku\",\r\n                      \"like\": \"20_04-lts*\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"Oracle\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"Oracle-Linux\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"6.*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"7.*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"7*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"8*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"equals\": \"ol83-lvm-gen2\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"OpenLogic\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"CentOS\",\r\n                        \"Centos-LVM\",\r\n                        \"CentOS-SRIOV\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"6.*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"7*\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"8*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"cloudera\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"cloudera-centos-os\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSku\",\r\n                      \"like\": \"7*\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"credativ\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"debian\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"8\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSku\",\r\n                          \"like\": \"9\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"Debian\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"debian-10\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSku\",\r\n                      \"like\": \"10\"\r\n                    }\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        \"then\": {\r\n          \"effect\": \"[parameters('effect')]\",\r\n          \"details\": {\r\n            \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n            \"existenceCondition\": {\r\n              \"allOf\": [\r\n                {\r\n                  \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                  \"equals\": \"AzureSecurityLinuxAgent\"\r\n                },\r\n                {\r\n                  \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                  \"equals\": \"Microsoft.Azure.Security.Monitoring\"\r\n                },\r\n                {\r\n                  \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/provisioningState\",\r\n                  \"equals\": \"Succeeded\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      }\r\n  }",
  "parameters": {},
  "classification": "Security",
  "sub_classification": "Application",
  "service_resource": [
    "Subscription"
  ],
  "resource_type": "Subscription",
  "severity": "high",
  "type": [
    "Cloud"
  ],
  "services": [
    "Azure"
  ],
  "scope": "global",
  "metadata": {},
  "resources": [],
  "is_temp": false,
  "is_system_policy": false,
  "recommendation": {
    "name": "Azure_Audit_Security_Agent_Installed_On_Linux_VMSS",
    "description": "Install the Azure Security agent on your Linux virtual machine scale sets in order to monitor your machines for security configurations and vulnerabilities. Results of the assessments can seen and managed in Azure Security Center.",
    "actions": []
  },
    "uri": "policy/azure_policy/global/azure/compliance/others/mfwpo"
}
