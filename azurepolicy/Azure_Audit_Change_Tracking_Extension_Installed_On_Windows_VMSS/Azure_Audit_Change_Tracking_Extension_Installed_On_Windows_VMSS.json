{
  "name": "Azure_Audit_Change_Tracking_Extension_Installed_On_Windows_VMSS",
  "policy_id": "/providers/Microsoft.Authorization/policyDefinitions/4bb303db-d051-4099-95d2-e3e1428a4d00",
  "display_name": "Azure Audit Change Tracking Extension Installed On Windows VMSS",
  "description": "Install ChangeTracking Extension on Windows virtual machine scale sets to enable File Integrity Monitoring(FIM) in Azure Security Center. FIM examines operating system files, Windows registries, application software, Linux system files, and more, for changes that might indicate an attack. The extension can be installed in virtual machines and locations supported by Azure Monitoring Agent.",
  "category": "service",
  "status": "active",
  "content": "{\r\n      \"displayName\": \"[Preview]: ChangeTracking extension should be installed on your Windows virtual machine scale sets\",\r\n      \"policyType\": \"BuiltIn\",\r\n      \"mode\": \"Indexed\",\r\n      \"description\": \"Install ChangeTracking Extension on Windows virtual machine scale sets to enable File Integrity Monitoring(FIM) in Azure Security Center. FIM examines operating system files, Windows registries, application software, Linux system files, and more, for changes that might indicate an attack. The extension can be installed in virtual machines and locations supported by Azure Monitoring Agent.\",\r\n      \"metadata\": {\r\n        \"version\": \"1.0.0-preview\",\r\n        \"category\": \"Security Center\",\r\n        \"policy_id\": \"/providers/Microsoft.Authorization/policyDefinitions/4bb303db-d051-4099-95d2-e3e1428a4d00\"\r\n      },\r\n      \"parameters\": {\r\n        \"effect\": {\r\n          \"type\": \"String\",\r\n          \"metadata\": {\r\n            \"displayName\": \"Effect\",\r\n            \"description\": \"Enable or disable the execution of the policy\"\r\n          },\r\n          \"allowedValues\": [\r\n            \"AuditIfNotExists\",\r\n            \"Disabled\"\r\n          ],\r\n          \"defaultValue\": \"AuditIfNotExists\"\r\n        },\r\n        \"listOfApplicableLocations\": {\r\n          \"type\": \"Array\",\r\n          \"metadata\": {\r\n            \"displayName\": \"Applicable Locations\",\r\n            \"description\": \"The list of locations where the policy should be applied.\",\r\n            \"strongType\": \"location\"\r\n          },\r\n          \"allowedValues\": [\r\n            \"australiasoutheast\",\r\n            \"australiaeast\",\r\n            \"brazilsouth\",\r\n            \"canadacentral\",\r\n            \"centralindia\",\r\n            \"centralus\",\r\n            \"eastasia\",\r\n            \"eastus2euap\",\r\n            \"eastus\",\r\n            \"eastus2\",\r\n            \"francecentral\",\r\n            \"japaneast\",\r\n            \"koreacentral\",\r\n            \"northcentralus\",\r\n            \"northeurope\",\r\n            \"norwayeast\",\r\n            \"southcentralus\",\r\n            \"southeastasia\",\r\n            \"switzerlandnorth\",\r\n            \"uaenorth\",\r\n            \"uksouth\",\r\n            \"westcentralus\",\r\n            \"westeurope\",\r\n            \"westus\",\r\n            \"westus2\"\r\n          ],\r\n          \"defaultValue\": [\r\n            \"australiasoutheast\",\r\n            \"australiaeast\",\r\n            \"brazilsouth\",\r\n            \"canadacentral\",\r\n            \"centralindia\",\r\n            \"centralus\",\r\n            \"eastasia\",\r\n            \"eastus2euap\",\r\n            \"eastus\",\r\n            \"eastus2\",\r\n            \"francecentral\",\r\n            \"japaneast\",\r\n            \"koreacentral\",\r\n            \"northcentralus\",\r\n            \"northeurope\",\r\n            \"norwayeast\",\r\n            \"southcentralus\",\r\n            \"southeastasia\",\r\n            \"switzerlandnorth\",\r\n            \"uaenorth\",\r\n            \"uksouth\",\r\n            \"westcentralus\",\r\n            \"westeurope\",\r\n            \"westus\",\r\n            \"westus2\"\r\n          ]\r\n        }\r\n      },\r\n      \"policyRule\": {\r\n        \"if\": {\r\n          \"allOf\": [\r\n            {\r\n              \"field\": \"type\",\r\n              \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n            },\r\n            {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('listOfApplicableLocations')]\"\r\n            },\r\n            {\r\n              \"anyOf\": [\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftWindowsServer\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"WindowsServer\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSKU\",\r\n                      \"in\": [\r\n                        \"2008-R2-SP1\",\r\n                        \"2008-R2-SP1-smalldisk\",\r\n                        \"2012-Datacenter\",\r\n                        \"2012-Datacenter-smalldisk\",\r\n                        \"2012-R2-Datacenter\",\r\n                        \"2012-R2-Datacenter-smalldisk\",\r\n                        \"2016-Datacenter\",\r\n                        \"2016-Datacenter-Server-Core\",\r\n                        \"2016-Datacenter-Server-Core-smalldisk\",\r\n                        \"2016-Datacenter-smalldisk\",\r\n                        \"2016-Datacenter-with-Containers\",\r\n                        \"2016-Datacenter-with-RDSH\",\r\n                        \"2019-Datacenter\",\r\n                        \"2019-Datacenter-Core\",\r\n                        \"2019-Datacenter-Core-smalldisk\",\r\n                        \"2019-Datacenter-Core-with-Containers\",\r\n                        \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                        \"2019-Datacenter-smalldisk\",\r\n                        \"2019-Datacenter-with-Containers\",\r\n                        \"2019-Datacenter-with-Containers-smalldisk\",\r\n                        \"2019-Datacenter-zhcn\"\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftWindowsServer\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"WindowsServerSemiAnnual\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSKU\",\r\n                      \"in\": [\r\n                        \"Datacenter-Core-1709-smalldisk\",\r\n                        \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                        \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"WindowsServerHPCPack\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftSQLServer\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"like\": \"*-WS2019\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"like\": \"*-WS2019-BYOL\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"like\": \"*-WS2016\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"like\": \"*-WS2016-BYOL\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"like\": \"*-WS2012R2\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"like\": \"*-WS2012R2-BYOL\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftRServer\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"MLServer-WS2016\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftVisualStudio\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"VisualStudio\",\r\n                        \"Windows\"\r\n                      ]\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftDynamicsAX\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"Dynamics\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSKU\",\r\n                      \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"microsoft-ads\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"windows-data-science-vm\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"equals\": \"MicrosoftWindowsDesktop\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"equals\": \"Windows-10\"\r\n                    }\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        },\r\n        \"then\": {\r\n          \"effect\": \"[parameters('effect')]\",\r\n          \"details\": {\r\n            \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n            \"existenceCondition\": {\r\n              \"allOf\": [\r\n                {\r\n                  \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                  \"equals\": \"ChangeTracking-Windows\"\r\n                },\r\n                {\r\n                  \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/Publisher\",\r\n                  \"equals\": \"Microsoft.Azure.ChangeTrackingAndInventory\"\r\n                },\r\n                {\r\n                  \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/provisioningState\",\r\n                  \"equals\": \"Succeeded\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      }\r\n  }",
  "parameters": {},
  "classification": "Security",
  "sub_classification": "Application",
  "service_resource": [
    "Subscription"
  ],
  "resource_type": "Subscription",
  "severity": "high",
  "type": [
    "Cloud"
  ],
  "services": [
    "Azure"
  ],
  "scope": "global",
  "metadata": {},
  "resources": [],
  "is_temp": false,
  "is_system_policy": false,
  "recommendation": {
    "name": "Azure_Audit_Change_Tracking_Extension_Installed_On_Windows_VMSS",
    "description": "Install ChangeTracking Extension on Windows virtual machine scale sets to enable File Integrity Monitoring(FIM) in Azure Security Center. FIM examines operating system files, Windows registries, application software, Linux system files, and more, for changes that might indicate an attack. The extension can be installed in virtual machines and locations supported by Azure Monitoring Agent.",
    "actions": []
  },
    "uri": "policy/azure_policy/global/azure/compliance/others/wasdr"
}
